
import tensorflow as tf
import numpy as np
from tensorflow.keras.utils import to_categorical
NUM_CLASSES = 5
SMOOTHING = 0.1

def smooth_labels(one_hot_labels, smoothing=SMOOTHING):
    smooth_positives = 1.0 - smoothing
    smooth_negatives = smoothing / (NUM_CLASSES - 1)
    return one_hot_labels * smooth_positives + (1 - one_hot_labels) * smooth_negatives


def process_with_smoothing(image, label):
    image = tf.cast(image / 255. , tf.float32)
    label = tf.cast(label, tf.int32)

    # One-hot encode labels
    label_one_hot = tf.one_hot(label, 5)  # 5 classes
    label_smoothed = smooth_labels(label_one_hot)
    print(label_smoothed.shape)
    print(repr(label_smoothed))
    print(label_smoothed)
    return image, label_smoothed


labeled_train_dataset = labeled_train_dataset.map(process_with_smoothing)
val_dataset = val_dataset.map(process_with_smoothing)

